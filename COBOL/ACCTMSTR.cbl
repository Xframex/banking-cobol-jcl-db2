       IDENTIFICATION DIVISION.\n       PROGRAM-ID. ACCTMSTR.\n      \n       ENVIRONMENT DIVISION.\n       CONFIGURATION SECTION.\n       REPOSITORY.\n           FUNCTION ALL INTRINSIC.\n      \n       INPUT-OUTPUT SECTION.\n       FILE-CONTROL.\n           SELECT ACCOUNT-INPUT-FILE\n               ASSIGN TO UT-S-ACCTIN\n               ORGANIZATION IS LINE SEQUENTIAL.\n      \n           SELECT ACCOUNT-OUTPUT-FILE\n               ASSIGN TO UT-S-ACCTOUT\n               ORGANIZATION IS LINE SEQUENTIAL.\n      \n       DATA DIVISION.\n       FILE SECTION.\n       FD ACCOUNT-INPUT-FILE.\n       01 ACC-INPUT-RECORD            PIC X(100).\n      \n       FD ACCOUNT-OUTPUT-FILE.\n       01 ACC-OUTPUT-RECORD           PIC X(150).\n      \n       WORKING-STORAGE SECTION.\n      \n       01 WS-PROGRAM-INFO.\n           05 WS-PROGRAM-NAME         PIC X(8) VALUE 'ACCTMSTR'.\n           05 WS-VERSION              PIC X(5) VALUE '1.0.0'.\n           05 WS-EXECUTION-DATE       PIC 9(8).\n           05 WS-EXECUTION-TIME       PIC 9(6).\n      \n       01 WS-FILE-CONTROL.\n           05 WS-EOF-ACCTIN           PIC X VALUE 'N'.\n               88 ACCTIN-EOF              VALUE 'Y'.\n           05 WS-RECORD-COUNT         PIC 9(8) VALUE 0.\n           05 WS-SUCCESS-COUNT        PIC 9(8) VALUE 0.\n           05 WS-ERROR-COUNT          PIC 9(8) VALUE 0.\n      \n       COPY ACCTREC.\n       COPY SQLCA.\n       COPY ERRHDLR.\n      \n       01 WS-ACCOUNT-VARS.\n           05 WS-ACCT-NUMBER          PIC X(12).\n           05 WS-CUST-ID              PIC X(8).\n           05 WS-ACCT-TYPE            PIC X(1).\n           05 WS-ACCT-STATUS          PIC X(1).\n           05 WS-ACCT-BALANCE         PIC S9(11)V99 COMP-3 VALUE 0.\n           05 WS-INTEREST-RATE        PIC 9V9(4) COMP-3.\n           05 WS-OVERDRAFT-LIMIT      PIC S9(11)V99 COMP-3.\n      \n       01 WS-ACTION-FLAG.\n           05 WS-ACTION               PIC X(1).\n               88 ACTION-CREATE           VALUE 'C'.\n               88 ACTION-UPDATE           VALUE 'U'.\n               88 ACTION-RETRIEVE         VALUE 'R'.\n               88 ACTION-DELETE           VALUE 'D'.\n      \n       01 WS-DATE-TIME.\n           05 WS-CURRENT-DATE-YMD     PIC 9(8).\n           05 WS-CURRENT-TIME-HMS     PIC 9(6).\n      \n       PROCEDURE DIVISION.\n      \n       000-MAIN-PROCEDURE.\n           PERFORM 100-INITIALIZATION.\n           PERFORM 200-PROCESS-ACCOUNTS.\n           PERFORM 300-FINALIZATION.\n           STOP RUN.\n      \n       100-INITIALIZATION.\n           ACCEPT WS-EXECUTION-DATE FROM DATE YYYYMMDD.\n           ACCEPT WS-EXECUTION-TIME FROM TIME.\n           MOVE 0 TO WS-RECORD-COUNT.\n           MOVE 0 TO WS-SUCCESS-COUNT.\n           MOVE 0 TO WS-ERROR-COUNT.\n      \n           OPEN INPUT ACCOUNT-INPUT-FILE.\n           OPEN OUTPUT ACCOUNT-OUTPUT-FILE.\n      \n           DISPLAY 'ACCTMSTR: Starting Account Master Maintenance'.\n           DISPLAY 'Date: ' WS-EXECUTION-DATE ' Time: ' WS-EXECUTION-TIME.\n      \n       200-PROCESS-ACCOUNTS.\n           READ ACCOUNT-INPUT-FILE\n               AT END MOVE 'Y' TO WS-EOF-ACCTIN\n           END-READ.\n      \n           PERFORM UNTIL ACCTIN-EOF\n               ADD 1 TO WS-RECORD-COUNT\n      \n               PERFORM 210-PARSE-INPUT-RECORD\n               PERFORM 220-VALIDATE-ACTION\n      \n               IF WS-ACTION = 'C'\n                   PERFORM 230-CREATE-ACCOUNT\n               ELSE IF WS-ACTION = 'U'\n                   PERFORM 240-UPDATE-ACCOUNT\n               ELSE IF WS-ACTION = 'R'\n                   PERFORM 250-RETRIEVE-ACCOUNT\n               ELSE IF WS-ACTION = 'D'\n                   PERFORM 260-DELETE-ACCOUNT\n               ELSE\n                   PERFORM 270-LOG-INVALID-ACTION\n               END-IF\n      \n               READ ACCOUNT-INPUT-FILE\n                   AT END MOVE 'Y' TO WS-EOF-ACCTIN\n               END-READ\n           END-PERFORM.\n      \n       210-PARSE-INPUT-RECORD.\n           MOVE ACC-INPUT-RECORD(1:1) TO WS-ACTION.\n           MOVE ACC-INPUT-RECORD(2:12) TO WS-ACCT-NUMBER.\n           MOVE ACC-INPUT-RECORD(14:8) TO WS-CUST-ID.\n           MOVE ACC-INPUT-RECORD(22:1) TO WS-ACCT-TYPE.\n      \n       220-VALIDATE-ACTION.\n           IF WS-ACTION NOT = 'C' AND\n              WS-ACTION NOT = 'U' AND\n              WS-ACTION NOT = 'R' AND\n              WS-ACTION NOT = 'D'\n               MOVE 'N' TO WS-VALID-TRANSACTION\n           END-IF.\n      \n       230-CREATE-ACCOUNT.\n      *>    Insert new account into DB2\n           EXEC SQL\n               INSERT INTO ACCOUNTS\n                   (ACCOUNT_NUMBER, CUSTOMER_ID, ACCOUNT_TYPE,\n                    ACCOUNT_BALANCE, ACCOUNT_STATUS,\n                    CREATION_DATE, LAST_UPDATE_DATE, LAST_UPDATE_TIME)\n               VALUES\n                   (:WS-ACCT-NUMBER, :WS-CUST-ID, :WS-ACCT-TYPE,\n                    0.00, 'A', CURRENT_DATE, CURRENT_DATE, CURRENT_TIME)\n           END-EXEC.\n      \n           IF SQLCODE = 0\n               PERFORM 235-LOG-CREATE-SUCCESS\n               ADD 1 TO WS-SUCCESS-COUNT\n           ELSE\n               PERFORM 236-LOG-CREATE-ERROR\n               ADD 1 TO WS-ERROR-COUNT\n           END-IF.\n      \n       235-LOG-CREATE-SUCCESS.\n           STRING WS-EXECUTION-DATE DELIMITED BY SIZE\n               ' ' DELIMITED BY SIZE\n               WS-EXECUTION-TIME DELIMITED BY SIZE\n               ': CREATE SUCCESS - Account: ' DELIMITED BY SIZE\n               WS-ACCT-NUMBER DELIMITED BY SIZE\n               ' Customer: ' DELIMITED BY SIZE\n               WS-CUST-ID DELIMITED BY SIZE\n               INTO ACC-OUTPUT-RECORD\n           END-STRING.\n           WRITE ACC-OUTPUT-RECORD.\n      \n       236-LOG-CREATE-ERROR.\n           STRING WS-EXECUTION-DATE DELIMITED BY SIZE\n               ' ' DELIMITED BY SIZE\n               WS-EXECUTION-TIME DELIMITED BY SIZE\n               ': CREATE ERROR - SQLCODE=' DELIMITED BY SIZE\n               SQLCODE DELIMITED BY SIZE\n               INTO ACC-OUTPUT-RECORD\n           END-STRING.\n           WRITE ACC-OUTPUT-RECORD.\n      \n       240-UPDATE-ACCOUNT.\n      *>    Update existing account in DB2\n           EXEC SQL\n               UPDATE ACCOUNTS\n               SET ACCOUNT_STATUS = :WS-ACCT-STATUS\n                   LAST_UPDATE_DATE = CURRENT_DATE\n                   LAST_UPDATE_TIME = CURRENT_TIME\n               WHERE ACCOUNT_NUMBER = :WS-ACCT-NUMBER\n           END-EXEC.\n      \n           IF SQLCODE = 0\n               ADD 1 TO WS-SUCCESS-COUNT\n               STRING WS-EXECUTION-DATE DELIMITED BY SIZE\n                   ' UPDATE SUCCESS - ' DELIMITED BY SIZE\n                   WS-ACCT-NUMBER DELIMITED BY SIZE\n                   INTO ACC-OUTPUT-RECORD\n               END-STRING\n           ELSE\n               ADD 1 TO WS-ERROR-COUNT\n               STRING WS-EXECUTION-DATE DELIMITED BY SIZE\n                   ' UPDATE ERROR - SQLCODE=' DELIMITED BY SIZE\n                   SQLCODE DELIMITED BY SIZE\n                   INTO ACC-OUTPUT-RECORD\n               END-STRING\n           END-IF.\n           WRITE ACC-OUTPUT-RECORD.\n      \n       250-RETRIEVE-ACCOUNT.\n      *>    Retrieve account details from DB2\n           EXEC SQL\n               SELECT CUSTOMER_ID, ACCOUNT_TYPE, ACCOUNT_BALANCE,\n                      ACCOUNT_STATUS\n               INTO :WS-CUST-ID, :WS-ACCT-TYPE,\n                    :WS-ACCT-BALANCE, :WS-ACCT-STATUS\n               FROM ACCOUNTS\n               WHERE ACCOUNT_NUMBER = :WS-ACCT-NUMBER\n           END-EXEC.\n      \n           IF SQLCODE = 0\n               ADD 1 TO WS-SUCCESS-COUNT\n               STRING WS-EXECUTION-DATE DELIMITED BY SIZE\n                   ' RETRIEVE SUCCESS - Balance: ' DELIMITED BY SIZE\n                   WS-ACCT-BALANCE DELIMITED BY SIZE\n                   INTO ACC-OUTPUT-RECORD\n               END-STRING\n           ELSE\n               ADD 1 TO WS-ERROR-COUNT\n               STRING WS-EXECUTION-DATE DELIMITED BY SIZE\n                   ' RETRIEVE ERROR - Account not found' DELIMITED BY SIZE\n                   INTO ACC-OUTPUT-RECORD\n               END-STRING\n           END-IF.\n           WRITE ACC-OUTPUT-RECORD.\n      \n       260-DELETE-ACCOUNT.\n      *>    Mark account as inactive (soft delete)\n           EXEC SQL\n               UPDATE ACCOUNTS\n               SET ACCOUNT_STATUS = 'I'\n                   LAST_UPDATE_DATE = CURRENT_DATE\n                   LAST_UPDATE_TIME = CURRENT_TIME\n               WHERE ACCOUNT_NUMBER = :WS-ACCT-NUMBER\n           END-EXEC.\n      \n           IF SQLCODE = 0\n               ADD 1 TO WS-SUCCESS-COUNT\n           ELSE\n               ADD 1 TO WS-ERROR-COUNT\n           END-IF.\n      \n       270-LOG-INVALID-ACTION.\n           STRING WS-EXECUTION-DATE DELIMITED BY SIZE\n               ' INVALID ACTION - ' DELIMITED BY SIZE\n               WS-ACTION DELIMITED BY SIZE\n               INTO ACC-OUTPUT-RECORD\n           END-STRING.\n           WRITE ACC-OUTPUT-RECORD.\n           ADD 1 TO WS-ERROR-COUNT.\n      \n       300-FINALIZATION.\n           CLOSE ACCOUNT-INPUT-FILE.\n           CLOSE ACCOUNT-OUTPUT-FILE.\n      \n           DISPLAY 'ACCTMSTR: Processing Complete'.\n           DISPLAY 'Records Processed: ' WS-RECORD-COUNT.\n           DISPLAY 'Successful: ' WS-SUCCESS-COUNT.\n           DISPLAY 'Failed: ' WS-ERROR-COUNT.\n      \n           IF WS-ERROR-COUNT > 0\n               MOVE 8 TO RETURN-CODE\n           ELSE\n               MOVE 0 TO RETURN-CODE\n           END-IF.",
<parameter name="sha">
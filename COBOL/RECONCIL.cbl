       IDENTIFICATION DIVISION.
       PROGRAM-ID. RECONCIL.

       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       REPOSITORY.
           FUNCTION ALL INTRINSIC.

       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT TRANSACTION-INPUT-FILE
               ASSIGN TO UT-S-TRANIN
               ORGANIZATION IS LINE SEQUENTIAL.

           SELECT RECONCILIATION-REPORT
               ASSIGN TO UT-S-RECNRPT
               ORGANIZATION IS LINE SEQUENTIAL.

       DATA DIVISION.
       FILE SECTION.
       FD TRANSACTION-INPUT-FILE.
       01 TRN-INPUT-RECORD            PIC X(120).

       FD RECONCILIATION-REPORT.
       01 RECON-REPORT-LINE           PIC X(200).

       WORKING-STORAGE SECTION.

       01 WS-PROGRAM-INFO.
           05 WS-PROGRAM-NAME         PIC X(8) VALUE 'RECONCIL'.
           05 WS-EXECUTION-DATE       PIC 9(8).
           05 WS-EXECUTION-TIME       PIC 9(6).

       01 WS-FILE-CONTROL.
           05 WS-EOF-TRANIN           PIC X VALUE 'N'.
               88 TRANIN-EOF              VALUE 'Y'.
           05 WS-RECORD-COUNT         PIC 9(8) VALUE 0.

       01 WS-SUMMARY-TOTALS.
           05 WS-TOTAL-DEPOSITS       PIC S9(13)V99 COMP-3 VALUE 0.
           05 WS-TOTAL-WITHDRAWALS    PIC S9(13)V99 COMP-3 VALUE 0.
           05 WS-TOTAL-TRANSFERS      PIC S9(13)V99 COMP-3 VALUE 0.
           05 WS-NET-CHANGE           PIC S9(13)V99 COMP-3 VALUE 0.
           05 WS-DEPOSIT-COUNT        PIC 9(8) VALUE 0.
           05 WS-WITHDRAWAL-COUNT     PIC 9(8) VALUE 0.

       01 WS-TRANSACTION-VARS.
           05 WS-TXN-AMOUNT           PIC S9(11)V99 COMP-3.
           05 WS-TXN-TYPE             PIC X(1).

       COPY TRANREC.
       COPY SQLCA.

       PROCEDURE DIVISION.

       000-MAIN-PROCEDURE.
           PERFORM 100-INITIALIZATION.
           PERFORM 200-READ-TRANSACTIONS.
           PERFORM 300-GENERATE-REPORT.
           PERFORM 400-FINALIZATION.
           STOP RUN.

       100-INITIALIZATION.
           ACCEPT WS-EXECUTION-DATE FROM DATE YYYYMMDD.
           ACCEPT WS-EXECUTION-TIME FROM TIME.
           MOVE 0 TO WS-RECORD-COUNT.
           MOVE 0 TO WS-TOTAL-DEPOSITS.
           MOVE 0 TO WS-TOTAL-WITHDRAWALS.
           MOVE 0 TO WS-TOTAL-TRANSFERS.

           OPEN INPUT TRANSACTION-INPUT-FILE.
           OPEN OUTPUT RECONCILIATION-REPORT.

           DISPLAY 'RECONCIL: Starting Daily Reconciliation'.
           DISPLAY 'Date: ' WS-EXECUTION-DATE.

       200-READ-TRANSACTIONS.
           READ TRANSACTION-INPUT-FILE
               AT END MOVE 'Y' TO WS-EOF-TRANIN
           END-READ.

           PERFORM UNTIL TRANIN-EOF
               ADD 1 TO WS-RECORD-COUNT
               PERFORM 210-PARSE-TRANSACTION
               PERFORM 220-ACCUMULATE-TOTALS

               READ TRANSACTION-INPUT-FILE
                   AT END MOVE 'Y' TO WS-EOF-TRANIN
               END-READ
           END-PERFORM.

       210-PARSE-TRANSACTION.
           MOVE TRN-INPUT-RECORD(13:1) TO WS-TXN-TYPE.
           MOVE FUNCTION NUMVAL(TRN-INPUT-RECORD(14:15))
               TO WS-TXN-AMOUNT.

       220-ACCUMULATE-TOTALS.
           EVALUATE WS-TXN-TYPE
               WHEN 'D'
                   ADD WS-TXN-AMOUNT TO WS-TOTAL-DEPOSITS
                   ADD 1 TO WS-DEPOSIT-COUNT
               WHEN 'W'
                   ADD WS-TXN-AMOUNT TO WS-TOTAL-WITHDRAWALS
                   ADD 1 TO WS-WITHDRAWAL-COUNT
               WHEN 'T'
                   ADD WS-TXN-AMOUNT TO WS-TOTAL-TRANSFERS
           END-EVALUATE.

       300-GENERATE-REPORT.
           COMPUTE WS-NET-CHANGE =
               WS-TOTAL-DEPOSITS - WS-TOTAL-WITHDRAWALS.

           STRING 'DAILY RECONCILIATION REPORT'
               DELIMITED BY SIZE INTO RECON-REPORT-LINE.
           WRITE RECON-REPORT-LINE.

           STRING 'Date: ' WS-EXECUTION-DATE ' Time: '
               WS-EXECUTION-TIME DELIMITED BY SIZE
               INTO RECON-REPORT-LINE.
           WRITE RECON-REPORT-LINE.

           STRING '==========================================='
               DELIMITED BY SIZE INTO RECON-REPORT-LINE.
           WRITE RECON-REPORT-LINE.

           STRING 'Total Deposits:       ' WS-TOTAL-DEPOSITS
               DELIMITED BY SIZE INTO RECON-REPORT-LINE.
           WRITE RECON-REPORT-LINE.

           STRING 'Total Withdrawals:    ' WS-TOTAL-WITHDRAWALS
               DELIMITED BY SIZE INTO RECON-REPORT-LINE.
           WRITE RECON-REPORT-LINE.

           STRING 'Total Transfers:      ' WS-TOTAL-TRANSFERS
               DELIMITED BY SIZE INTO RECON-REPORT-LINE.
           WRITE RECON-REPORT-LINE.

           STRING 'Net Change:           ' WS-NET-CHANGE
               DELIMITED BY SIZE INTO RECON-REPORT-LINE.
           WRITE RECON-REPORT-LINE.

           STRING 'Transactions Processed: ' WS-RECORD-COUNT
               DELIMITED BY SIZE INTO RECON-REPORT-LINE.
           WRITE RECON-REPORT-LINE.

       400-FINALIZATION.
           CLOSE TRANSACTION-INPUT-FILE.
           CLOSE RECONCILIATION-REPORT.

           DISPLAY 'RECONCIL: Reconciliation Complete'.
           DISPLAY 'Transactions: ' WS-RECORD-COUNT.
           DISPLAY 'Net Change: ' WS-NET-CHANGE.

           MOVE 0 TO RETURN-CODE.